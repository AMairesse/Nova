{% extends "base.html" %}
{% load crispy_forms_tags i18n %}

{% block content %}
<div class="container py-4" style="max-width: 760px;">
  <h2 class="mb-3">
    {% if object.pk %}
      Edit tool
    {% else %}
      Add tool
    {% endif %}
  </h2>

  <form method="post" novalidate>
    {% csrf_token %}
    {% if request.GET.from %}
      <input type="hidden" name="from" value="{{ request.GET.from }}">
    {% endif %}

    {# Main Tool model fields #}
    {{ form|crispy }}

    <hr>
    <h5>Credentials</h5>

    {{ formset.management_form }}

    <div id="credentials-forms">
      {% for cred_form in formset %}
        <div class="border rounded p-3 mb-3">
          {% for hidden in cred_form.hidden_fields %}
            {{ hidden }}
          {% endfor %}

          {{ cred_form|crispy }}

          {% if formset.can_delete %}
            <div class="form-check mt-2">
              {{ cred_form.DELETE }}
              <label class="form-check-label"
                     for="{{ cred_form.DELETE.id_for_label }}">
                Delete this credential
              </label>
            </div>
          {% endif %}
        </div>
      {% endfor %}
    </div>

    <button type="submit" class="btn btn-primary me-2">
      <i class="bi bi-check-lg me-1"></i>{% trans "Save" %}
    </button>
    {% if request.GET.from %}
      <a href="{% url 'user_settings:dashboard' %}#pane-{{ request.GET.from }}"
        class="btn btn-secondary">
        {% trans "Cancel" %}
      </a>
    {% else %}
      <a href="{% url 'user_settings:tool' %}" class="btn btn-secondary">
        {% trans "Cancel" %}
      </a>
    {% endif %}
  </form>
</div>
{% endblock %}
